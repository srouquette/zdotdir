#!/bin/zsh
#
# .zstyles - zstyle settings for features/plugins that need them.
#

#
# Antidote
#

: ${ANTIDOTE_HOME:=${XDG_CACHE_HOME:-~/.cache}/repos}

# Keep all 3 for different test scenarios.
antidote_repo=$ANTIDOTE_HOME/mattmc3/antidote
# antidote_repo=~/Projects/mattmc3/antidote
# antidote_repo=${HOMEBREW_PREFIX:-/opt/homebrew}/opt/antidote/share/antidote

zstyle ':antidote:home' path $ANTIDOTE_HOME
zstyle ':antidote:repo' path $antidote_repo
zstyle ':antidote:bundle' use-friendly-names 'yes'
zstyle ':antidote:plugin:*' defer-options '-p'
zstyle ':antidote:*' zcompile 'yes'

#
# Zephyr features
#

# Use caching.
zstyle ':zephyr:plugin:*' 'use-cache' yes

#
# Editor
#

# Set the key mapping style to 'emacs' or 'vi'.
zstyle ':zephyr:plugin:editor' key-bindings 'emacs'

# Auto convert .... to ../..
zstyle ':zephyr:plugin:editor' dot-expansion 'yes'

# Use ^z to return background processes to foreground.
zstyle ':zephyr:plugin:editor' symmetric-ctrl-z 'yes'

# Expand aliases to their actual command like Fish abbreviations.
zstyle ':zephyr:plugin:editor' glob-alias 'yes'
noexpand=(
  =
  l
  ls
  g
  grep
  gpg
  rg
  vi
  z
  0 1 2 3 4 5 6 7 8 9
)
zstyle ':zephyr:plugin:editor:glob-alias' noexpand $noexpand

# Set the default (magic) command when hitting enter on an empty prompt.
zstyle ':zephyr:plugin:editor' magic-enter 'yes'
zstyle ':zephyr:plugin:editor:magic-enter' command 'la'
zstyle ':zephyr:plugin:editor:magic-enter' git-command 'git status -sb .'

# Editor style
zstyle -s ':zephyr:plugin:editor' key-bindings 'emacs'

# From compinit docs:
# To avoid these tests and make all files found be used without asking, use the
# option -u, and to make compinit silently ignore all insecure files and directories
# use the option -i. This security check is skipped entirely when the -C option is
# given, provided the dumpfile exists.
zstyle ':zephyr:plugin:completion' 'disable-compfix' yes
zstyle ':zephyr:plugin:completion' compstyle 'zephyr'

#
# Prompt
#

# Set prompt
zstyle ':zephyr:plugin:prompt' theme starship syl

#
# Completions
#

zstyle ':plugin:ez-compinit' 'compstyle' 'zshzoo'

#
# fzf-tab
#

# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false
# set descriptions format to enable group support
# NOTE: don't use escape sequences here, fzf-tab will ignore them
zstyle ':completion:*:descriptions' format '[%d]'
# set list-colors to enable filename colorizing
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# force zsh not to show completion menu, which allows fzf-tab to capture the unambiguous prefix
zstyle ':completion:*' menu no
# preview directory's content with eza when completing cd
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --all --git --icons --only-dirs --color=always $realpath'
# zstyle ':fzf-tab:complete:cd:*' extra-opts --preview='eza -1 --all --git --icons --group-directories-first --color=always $realpath'

# zstyle ':fzf-tab:complete:*:*' fzf-preview 'less ${(Q)realpath}'

# zstyle ':fzf-tab:*' prefix 'â™¦ '
# zstyle ':fzf-tab:complete:*' fzf-preview 'less ${(Q)realpath}'
# zstyle ':fzf-tab:complete:*:*' fzf-preview 'less ${(Q)realpath}'
# zstyle ':fzf-tab:complete:*:*' fzf-preview 'echo "DEBUG: ${(Q)realpath}"'

# zstyle ':fzf-tab:*' print-query alt-enter
# zstyle ':fzf-tab:*' single-group color header

# zstyle ':completion:*:descriptions' format '[%d]'

#
# Misc
#
# zstyle -e ':autocomplete:list-choices:*' list-lines 'reply=( $(( LINES / 3 )) )'
# bindkey '\t' fzf-tab-complete "$terminfo[kcbt]" fzf-tab-complete
# bindkey -M menuselect '\t' fzf-tab-complete "$terminfo[kcbt]" fzf-tab-complete

# alias-finder

zstyle ':omz:plugins:alias-finder' autoload yes
zstyle ':omz:plugins:alias-finder' longer yes
zstyle ':omz:plugins:alias-finder' exact yes
zstyle ':omz:plugins:alias-finder' cheaper yes
